-----------------------------------------------------------
-- æ•´åˆè‡ªå®šä¹‰UIä¸åŸè„šæœ¬åŠŸèƒ½
-----------------------------------------------------------
-- ================ åŸºç¡€æœåŠ¡ä¸å˜é‡ ================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local Color3 = Color3
local UDim2 = UDim2
local Instance = Instance
local task = task
local Enum = Enum

-- ================ è‡ªå®šä¹‰UIåˆ›å»º ================
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local ato = Instance.new("TextButton")

ScreenGui.Parent = PlayerGui
Frame.Name = "CustomFrame"
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(248, 248, 248) -- UIç•Œé¢é¢œè‰²
Frame.Position = UDim2.new(0.326148063, 0, 0.29880476, 0) -- UIç•Œé¢çš„ç”Ÿæˆçš„ä½ç½®
Frame.Size = UDim2.new(0, 392, 0, 500) -- UIçš„å¤§å°
Frame.Active = true -- æ˜¯å¦ä¸€ç›´æ˜¾ç¤º
Frame.Draggable = true -- æ˜¯å¦æ‹–åŠ¨

ato.Name = "CustomButton"
ato.Parent = Frame
ato.Text = "åŠŸèƒ½æŒ‰é’®"
ato.Position = UDim2.new(0.1, 0, 0.1, 0)
ato.Size = UDim2.new(0.8, 0, 0.1, 0)

-- ================ åŠ è½½ Krnl ä¸“ç”¨ Venyx UI (æ¨è) ================
local VenusUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Stefanuk12/Venyx-UI-Library/main/source.lua"))()
local Window = VenusUI.new("DANGER Ilde Hub", 5013109572)  -- ä¸»çª—å£æ ‡é¢˜
print("âœ… Venyx UI åŠ è½½æˆåŠŸï¼")

-- ================ æ³¨å…¥å™¨æ–‡ä»¶æ“ä½œå…¼å®¹ï¼ˆæ ¸å¿ƒï¼šæ–‡ä»¶å¤¹éªŒè¯ + åæ ‡ä¿å­˜ï¼‰ ================
local readFunc, writeFunc, getPathFunc
pcall(function()
    if type(syn) == "table" then
        readFunc = syn.readfile or readfile
        writeFunc = syn.writefile or writefile
        getPathFunc = syn.datapath  -- å¿è€…æ³¨å…¥å™¨æ²™ç›’è·¯å¾„
    else
        readFunc = readfile or readFile
        writeFunc = writefile or writeFile
        getPathFunc = function() return "Roblox/Scripts" end  -- å…¶ä»–æ³¨å…¥å™¨é»˜è®¤è·¯å¾„
    end
end)

-- ================ æ–‡ä»¶å¤¹éªŒè¯æ ¸å¿ƒé€»è¾‘ ================
-- 1. è·å–éªŒè¯æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆè·¨æ³¨å…¥å™¨å…¼å®¹ï¼‰
local function getVerifyFolderPath()
    local basePath
    if getPathFunc then
        basePath = getPathFunc()  -- ä¼˜å…ˆç”¨æ³¨å…¥å™¨æä¾›çš„æ²™ç›’è·¯å¾„
    else
        -- é™çº§è·¯å¾„ï¼šé€‚é…Windows/macOS/Studio
        basePath = "C:/RobloxScripts"
        pcall(function()
            if game:GetService("RunService"):IsStudio() then
                basePath = "Roblox/Scripts"
            elseif string.find(game:GetService("MarketplaceService"):GetProductInfo(1).Name, "Mac") then
                basePath = "~/Library/Roblox/Scripts"
            end
        end)
    end
    return basePath .. "/DANGER_Ilde_Verify"  -- éªŒè¯æ–‡ä»¶å¤¹åç§°
end

-- 2. æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼ˆé€šè¿‡è¯»å–æ ‡è®°æ–‡ä»¶åˆ¤æ–­ï¼‰
local function folderExists()
    if not readFunc then return false end  -- æ— æ–‡ä»¶æ“ä½œèƒ½åŠ›åˆ™è§†ä¸ºé¦–æ¬¡ä½¿ç”¨
    local folderPath = getVerifyFolderPath()
    -- å°è¯•è¯»å–æ–‡ä»¶å¤¹å†…çš„æ ‡è®°æ–‡ä»¶ï¼ŒæˆåŠŸåˆ™è§†ä¸ºæ–‡ä»¶å¤¹å­˜åœ¨
    return pcall(function() readFunc(folderPath .. "/.verify") end)
end

-- 3. åˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ï¼ˆå†™å…¥ç©ºæ ‡è®°æ–‡ä»¶è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹ï¼‰
local function createVerifyFolder()
    if not writeFunc then return end  -- æ— å†™å…¥èƒ½åŠ›åˆ™è·³è¿‡ï¼ˆä¸‹æ¬¡ä»éœ€éªŒè¯ï¼‰
    local folderPath = getVerifyFolderPath()
    local success = pcall(function()
        writeFunc(folderPath .. "/.verify", "")  -- å†™å…¥ç©ºæ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºçˆ¶æ–‡ä»¶å¤¹
        print("âœ… éªŒè¯æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼š" .. folderPath)
    end)
    if not success then
        -- é™çº§æ–¹æ¡ˆï¼šç”¨PlayerGuiä¸´æ—¶æ–‡ä»¶å¤¹ï¼ˆä»…å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰
        local tempFolder = Instance.new("Folder")
        tempFolder.Name = "DANGER_Ilde_Verify"
        tempFolder.Parent = PlayerGui
        print("âš ï¸  æŒä¹…åŒ–æ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤¹ï¼ˆä»…å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰")
    end
end

-- ================ å…¬å‘Šå¼¹çª—ï¼ˆä¿ç•™åŠŸèƒ½ï¼‰ ================
local function showAnnouncement()
    local NoticeWindow = VenusUI.new("å…¬å‘Š", 5013109572)
    local NoticeTab = NoticeWindow:addTab("æ›´æ–°æ—¥å¿—")
    NoticeTab:addSection("3.1æ±‰åŒ–ç‰ˆ DANGER Ilde å…¬å‘Š")
    
    local logText = [[æ›´æ–°æ—¥å¿—:
8æœˆ21æ—¥05:35æ›´æ–°å†›äº‹å¤§äº¨å»é™¤GBå¤±æ•ˆè„šæœ¬å…¨è‡ªåŠ¨å†œåœºè„šæœ¬æŒ‚æœºå³å¯
8æœˆ21æ—¥10:07æ›´æ–°å¢¨æ°´æ¸¸æˆæ–°ç‰ˆè€å¤–XaåŒ…æ‹¬ä½¿ç”¨æ•™ç¨‹è·å–æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹
8æœˆ21æ—¥00:58æ›´æ–°WARMIX[PVP FPS æ­¦å™¨æˆ˜æ–—å°„å‡»æª]-ä¿æŠ¤æˆ¿å±‹å…å—æ€ªç‰©ä¾µå®³-ä¿æŠ¤æ€»ç»Ÿ
8æœˆ22æ—¥18:17æ·»åŠ äº†chainæœåŠ¡å™¨è„šæœ¬
9æœˆ12æ—¥æ›´æ–°å¢¨æ°´æ¸¸æˆæ±‰åŒ–è„šç›®å‰ä½œè€…å·²å­¦ä¼šæ±‰åŒ–é€æ¸æ±‰åŒ–ä¸­
9æœˆ13æ—¥10:00æ›´æ–°æ–°çš„å¢¨æ°´æ¸¸æˆæ±‰åŒ–å»é™¤å¢¨æ°´æ¸¸æˆè¿‡æœŸè„šæœ¬å»é™¤ink-gameæ­£å¸¸ç‰ˆæ·»åŠ ink-gameæµ‹è¯•ç‰ˆæ±‰åŒ–
9æœˆ13æ—¥16:12å…¨é¢å–æ¶ˆæ±‰åŒ–æ›´æ–°æ–°çš„æ–¹æ³•ç­‰å¾…åŠå¤©æ–°æ›´æ–°äº†Xaé“¾æ¥ä¿®å¤è¿‡æœŸ
9æœˆ13æ—¥23:08æ›´æ–°ä¸€é”®æ±‰åŒ–è„šæœ¬æ‰“å¼€è„šæœ¬ç‚¹å‡»æŒ‰é’®å°†è¿›è¡Œæ±‰åŒ–ç›®å‰åªæ”¯æŒå¢¨æ°´æ¸¸æˆaxæˆ–ink-gameå’ŒRINGTAä¸€é”®æ±‰åŒ–è„šæœ¬åœ¨å¢¨æ°´æ¸¸æˆèœå•(ç¦æ­¢æ‹¿å»åœˆğŸ’°å°¤å…¶æ˜¯çŸ¥é“æºç åœ°å€çš„äºº)
9æœˆ14æ—¥12:23æ·»åŠ äº†æœ€å¼ºæˆ˜åœºæ±‰åŒ–è¿˜æ˜¯åœ¨ä¸€é”®æ±‰åŒ–è„šæœ¬é‡Œé¢ï¼Œè¿˜æ˜¯åœ¨å¢¨æ°´èœå•]]
    
    NoticeTab:addLabel(logText)
    NoticeTab:addButton("æˆ‘çŸ¥é“äº†", function()
        NoticeWindow:close()
    end)
    
    while NoticeWindow.gui.Parent do task.wait() end
end

-- ================ åæ ‡æ–‡ä»¶è¯»å†™ï¼ˆä¿ç•™åŠŸèƒ½ï¼‰ ================
local csvFilePath = getPathFunc and (getPathFunc() .. "/DANGER_Ilde_Coords.csv") or "DANGER_Ilde_Coords.csv"
local savedCoordinates = {}

local function readCSVFile()
    if not readFunc then return {} end
    local success, content = pcall(readFunc, csvFilePath)
    if not success or not content then return {} end
    local coords = {}
    for i, line in ipairs(content:split("\n")) do
        if i > 1 and line ~= "" then
            local parts = line:split(",")
            if #parts == 4 then
                table.insert(coords, {
                    name = parts[1],
                    x = tonumber(parts[2]),
                    y = tonumber(parts[3]),
                    z = tonumber(parts[4])
                })
            end
        end
    end
    return coords
end

local function writeCSVFile()
    if not writeFunc then return end
    local csv = "åç§°,Xåæ ‡,Yåæ ‡,Zåæ ‡\n"
    for _, coord in ipairs(savedCoordinates) do
        csv ..= string.format("%s,%.2f,%.2f,%.2f\n", coord.name, coord.x, coord.y, coord.z)
    end
    pcall(writeFunc, csvFilePath, csv)
end

-- ================ æ ¸å¿ƒåŠŸèƒ½Tabåˆ›å»ºï¼ˆåŸºäºVenyx UIï¼‰ ================
-- 1. åæ ‡ç®¡ç†Tab
local CoordTab = Window:addTab("åæ ‡ç®¡ç†")
CoordTab:addSection("å®æ—¶åæ ‡")
local coordLabel = CoordTab:addLabel("å®æ—¶åæ ‡ï¼šX: ---, Y: ---, Z: ---")

CoordTab:addSection("åæ ‡æ“ä½œ")
local coordName = ""
CoordTab:addTextbox("åæ ‡åç§°", "è¾“å…¥åæ ‡åç§°", function(Value)
    coordName = Value
end)

CoordTab:addButton("ä¿å­˜åæ ‡", function()
    local rootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not rootPart then
        warn("è§’è‰²æœªåŠ è½½")
        return
    end
    local pos = rootPart.Position
    local name = coordName ~= "" and coordName or "æœªå‘½ååæ ‡"
    table.insert(savedCoordinates, {name = name, x = pos.X, y = pos.Y, z = pos.Z})
    writeCSVFile()
    print(string.format("âœ… ä¿å­˜åæ ‡ï¼š%s (X:%.1f, Y:%.1f, Z:%.1f)", name, pos.X, pos.Y, pos.Z))
end)

-- 2. ç©å®¶ä¼ é€Tab
local PlayerTab = Window:addTab("ç©å®¶ä¼ é€")
PlayerTab:addSection("åœ¨çº¿ç©å®¶")
local function refreshPlayerList()
    -- æ¸…ç†æ—§æŒ‰é’®
    for _, child in ipairs(PlayerTab.sectionFrames["åœ¨çº¿ç©å®¶"].Frame:GetChildren()) do
        if child:IsA("TextButton") and child.Name:match("PlayerBtn") then
            child:Destroy()
        end
    end
    -- æ·»åŠ æ–°ç©å®¶æŒ‰é’®
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            PlayerTab:addButton("ä¼ é€è‡³ " .. player.Name, function()
                local rootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                local targetRoot = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if rootPart and targetRoot then
                    rootPart.CFrame = targetRoot.CFrame
                end
            end)
        end
    end
end
refreshPlayerList()
PlayerTab:addButton("åˆ·æ–°ç©å®¶åˆ—è¡¨", refreshPlayerList)

-- 3. é€šç”¨åŠŸèƒ½Tab
local FuncTab = Window:addTab("é€šç”¨åŠŸèƒ½")
FuncTab:addSection("åŸºç¡€åŠŸèƒ½")
FuncTab:addToggle("é£è¡Œæ¨¡å¼", false, function(State)
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.Fly = State
    end
end)

FuncTab:addSlider("ç§»åŠ¨é€Ÿåº¦", 16, 1, 100, function(Value)
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = Value
    end
end)

-- 4. è„šæœ¬ç®¡ç†Tab
local ScriptTab = Window:addTab("è„šæœ¬ç®¡ç†")
ScriptTab:addSection("æ³¨å…¥å™¨ä¸‹è½½")
ScriptTab:addButton("å¤åˆ¶ Krnl ä¸‹è½½é“¾æ¥", function()
    setclipboard("http://Krnl.vip")
    print("âœ… Krnlé“¾æ¥å·²å¤åˆ¶")
end)

ScriptTab:addSection("åŠŸèƒ½è„šæœ¬")
ScriptTab:addButton("æ‰§è¡Œ é£è¡Œè„šæœ¬", function()
    loadstring(game:HttpGet("https://pastebin.com/raw/LY9W7CPL"))()
end)

-- ================ æ‰§è¡Œæµç¨‹ï¼ˆä»…ä¿ç•™æ–‡ä»¶å¤¹éªŒè¯ï¼‰ ================
local isFirstUse = not folderExists()
if isFirstUse then
    -- é¦–æ¬¡ä½¿ç”¨ï¼šåˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ â†’ æ˜¾ç¤ºå…¬å‘Š
    createVerifyFolder()
    showAnnouncement()
    print("ğŸ†• é¦–æ¬¡ä½¿ç”¨ï¼šå·²åˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ï¼Œä¸‹æ¬¡å¯åŠ¨å°†è·³è¿‡æ£€æµ‹")
else
    -- éé¦–æ¬¡ä½¿ç”¨ï¼šç›´æ¥æ˜¾ç¤ºå…¬å‘Šï¼ˆè·³è¿‡éªŒè¯ï¼‰
    showAnnouncement()
    print("âœ… æ£€æµ‹åˆ°éªŒè¯æ–‡ä»¶å¤¹ï¼Œç›´æ¥åŠ è½½åŠŸèƒ½")
end

-- ================ å®æ—¶åæ ‡æ›´æ–° ================
RunService.Heartbeat:Connect(function()
    local rootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        local pos = rootPart.Position
        coordLabel.Text = string.format("å®æ—¶åæ ‡ï¼šX: %.1f, Y: %.1f, Z: %.1f", pos.X, pos.Y, pos.Z)
    end
end)

-- è‡ªå®šä¹‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆå¯æ ¹æ®éœ€æ±‚æ‰©å±•ï¼‰
ato.MouseButton1Click:Connect(function()
    print("è‡ªå®šä¹‰æŒ‰é’®è¢«ç‚¹å‡»")
    -- å¯åœ¨æ­¤æ·»åŠ è‡ªå®šä¹‰é€»è¾‘
end)

-- 4. è„šæœ¬ç®¡ç†Tab
local ScriptTab = Window:addTab("è„šæœ¬ç®¡ç†")
ScriptTab:addSection("æ³¨å…¥å™¨ä¸‹è½½")
ScriptTab:addButton("å¤åˆ¶ Krnl ä¸‹è½½é“¾æ¥", function()
    setclipboard("http://Krnl.vip")
    print("âœ… Krnlé“¾æ¥å·²å¤åˆ¶")
end)

ScriptTab:addSection("åŠŸèƒ½è„šæœ¬")
ScriptTab:addButton("æ‰§è¡Œ é£è¡Œè„šæœ¬", function()
    loadstring(game:HttpGet("https://pastebin.com/raw/LY9W7CPL"))()
end)

-- ================ æ‰§è¡Œæµç¨‹ï¼ˆä»…ä¿ç•™æ–‡ä»¶å¤¹éªŒè¯ï¼‰ ================
local isFirstUse = not folderExists()
if isFirstUse then
    -- é¦–æ¬¡ä½¿ç”¨ï¼šåˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ â†’ æ˜¾ç¤ºå…¬å‘Š
    createVerifyFolder()
    showAnnouncement()
    print("ğŸ†• é¦–æ¬¡ä½¿ç”¨ï¼šå·²åˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ï¼Œä¸‹æ¬¡å¯åŠ¨å°†è·³è¿‡æ£€æµ‹")
else
    -- éé¦–æ¬¡ä½¿ç”¨ï¼šç›´æ¥æ˜¾ç¤ºå…¬å‘Šï¼ˆè·³è¿‡éªŒè¯ï¼‰
    showAnnouncement()
    print("âœ… æ£€æµ‹åˆ°éªŒè¯æ–‡ä»¶å¤¹ï¼Œç›´æ¥åŠ è½½åŠŸèƒ½")
end

-- ================ å®æ—¶åæ ‡æ›´æ–° ================
RunService.Heartbeat:Connect(function()
    local rootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        local pos = rootPart.Position
        coordLabel.Text = string.format("å®æ—¶åæ ‡ï¼šX: %.1f, Y: %.1f, Z: %.1f", pos.X, pos.Y, pos.Z)
    end
end)
